\documentclass[twocolumn]{article}

% Set for specific document
\def\DOCTITLE{CSC3121 Distributed Systems Coursework 1}
\def\DOCAUTHOR{Dan Nixon (120263697)}
\def\DOCDATE{13/11/2015}

% Set document attributes
\title{\DOCTITLE}
\author{\DOCAUTHOR}
\date{\DOCDATE}

\usepackage{fullpage}
\usepackage{scrextend}
\usepackage{titlesec}
\usepackage{fancyhdr}

% Handle graphics correctly
\ifx\pdftexversion\undefined
\usepackage{graphicx}
% \usepackage[dvips]{graphicx}
\else
\usepackage[pdftex]{graphicx}
\DeclareGraphicsRule{*}{mps}{*}{}
\fi

% Setup headers and footers
\pagestyle{fancy}
\lhead{}
\chead{\DOCTITLE}
\rhead{}
\rfoot{\DOCDATE}
\cfoot{\thepage}
\lfoot{\DOCAUTHOR}

% New page for each section
\newcommand{\sectionbreak}{\clearpage}

% Set header and footer sizes
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\setlength{\headheight}{15.2pt}
\setlength{\headsep}{15.2pt}

\begin{document}

\section{Question 1}

The correctness of the system as defined by the specification can be summarised
as follows: a fire engine should be dispatched if and only if there is at least
one \textit{fire!} message received by computer C which is not followed by a
\texttt{fire out} message $2d + e$ time units later. This being the case depends
on the following:

\begin{enumerate}
  \item[1] For a \textit{fire!} message $M_{f}$ and \textit{fire out} message
           $M_{o}$, the relation $M_{f} \Rightarrow M_{o}$ must hold.
  \item[2] In the event of multiple fires, \textit{fire out} messages should
           only negate the corresponding \textit{fire!} message and not those
           caused by other fires.
\end{enumerate}

Both of these conditions can be violated in the current system.

\subsection{Violation of condition 1}
\label{sec:violation_of_condition_1}

This describes the case where the \textit{fire!} message takes the maximum
transfer time ($e$) between computer A and C and all other messages
(\textit{fire!} from A to B, \textit{fire out} from B to C) and events (the fire
being extinguished) happen in a significantly shorter time.

This case is demonstrated in figure \ref{fig:failure_case_1}.

This results in the \textit{fire out} message for a given fire arriving before
the corresponding \textit{fire!} message.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.4\textwidth]{out/failure_case_1.eps}
  \caption{Violation of condition 1}
  \label{fig:failure_case_1}
\end{figure}

In this case the system fails as a fire engine will be dispatched when the fire
has already been extinguished by the sprinkler system.

\subsection{Violation of condition 2}
\label{sec:violation_of_condition_2}

This describes the case when between computer B sending a \textit{fire out}
message ($E1$) and the same message being received by computer C, a new
\textit{fire!} message ($F2$) is sent by computer A which is received at
computer C before $E1$.

This case is demonstrated in figure \ref{fig:failure_case_2}.

In this case the last message received by the fire service computer C will be
\textit{fire out} and will have arrived within $2d + e$ time units of the last
\textit{fire!} message ($F2$).

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.4\textwidth]{out/failure_case_2.eps}
  \caption{Violation of condition 2}
  \label{fig:failure_case_2}
\end{figure}

In this case the system has failed as $F2$ signals a fire that cannot be
extinguished by the sprinkler system yet the fire service will not dispatch a
fire engine.

\section{Question 2}

The use of logical clocks in the system allows the order of messages to be
tracked within the system, this can be used by computer C to determine the
validity of a message based on its timestamp compared to the local logical
clock of computer C.

A brief overview of the operation of such a system is shown in figure
\ref{fig:logical_clocks}.

In this design computer A sends \texttt{fire!} messages to computers B and C
when it receives a signal from a fire detection sensor (it does not receive
messages from either computer).

Computer B receives all messages from computer A and sends \textit{fire out}
messages to computer C when it detects that all fires are extinguished.

The local logical clock ($C_{b}$) of computer B is set to $max(C_{b}, T_{m} +
1)$ when message $m$ is received (where $T_{m}$ is the timestamp of message
$m$).

When C receives either a \textit{fire!} or \textit{fire out} message ($m$) it
first examines the timestamp of the message ($T_{m}$), if the timestamp is equal
to or greater than the local logical clock of computer C ($C_{c}$) then the
message is processed as normal and $C_{c}$ is set such that $C_{c} = max(C_{c},
T_{m} + 1)$, otherwise if $T_{m} < C_{c}$ the message is discarded as computer C
will have already received more recent information than that described by $m$.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.4\textwidth]{out/logical_clocks.eps}
  \caption{Use of logical clocks}
  \label{fig:logical_clocks}
\end{figure}

In this proposed system the clock starting value of computer A ($C_{a}$) is set
to 10 and the increment ($I_{a}$) set to 10. The starting values of computers B
and C ($C_{b}$ and $C_{c}$) are both set to 0 and the increments ($I_{b}$ and
$I_{c}$) are set to 1.

This is to ensure that timestamps for subsequent fires are significantly larger
than the current local logical clocks on both computers B and C for the purpose
for the purpose of demonstration.

\subsection{Correctness of proposed design}

TODO

\subsection{Condition 1}

Figure \ref{fig:logical_clocks_fc1} demonstrates how the new system handles the
failure case described in section \ref{sec:violation_of_condition_1}.

In this case the \textit{fire!} message $F1$ does not reach computer C until
after the \textit{fire out} from computer B has already been received.

As a \textit{fire out} message will always have a higher timestamp than the
\textit{fire!} message indicating the detection of the same fire, the
\textit{fire!} message can safely be discarded assuming its timestamp is less
than the local logical clock of computer C ($C_{c}$).

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.4\textwidth]{out/logical_clocks_fc1.eps}
  \caption{Possible violation of condition 1}
  \label{fig:logical_clocks_fc1}
\end{figure}

\subsection{Condition 2}

Figure \ref{fig:logical_clocks_fc2} demonstrates how the new system handles the
failure case described in section \ref{sec:violation_of_condition_2}.

In this case the \textit{fire out} message $E1$ does not reach computer C until
after another \textit{fire!} message $F2$ has already been received by computer
C indicating the detection of a new fire that cannot be extinguished by the
sprinklers.

Here the \textit{fire out} message $E1$ is discarded doe to the \textit{fire!}
message $F2$ being received by computer C first, thus setting the local logical
clock of computer C to a higher timestamp then message $E1$.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.4\textwidth]{out/logical_clocks_fc2.eps}
  \caption{Possible violation of condition 2}
  \label{fig:logical_clocks_fc2}
\end{figure}

Discarding a \textit{fire out} message in this was can be considered safe as
providing that the last message to be received by computer C is a \textit{fire!}
message originating from the detection of a new fire that started after the
first was extinguished then a fire engine will still be required (unless the
delivery of another \textit{fire out} message follows).

\section{Question 3}

TODO

\end{document}
